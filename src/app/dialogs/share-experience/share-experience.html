<div class="max-w-2xl w-[90vw] p-6 sm:p-8 bg-white rounded-xl">
  <form
    [formGroup]="experienceForm"
    (ngSubmit)="onSubmit()"
    class="space-y-6 relative max-h-[80vh] overflow-y-auto no-scrollbar"
  >
    <div class="flex justify-between items-center">
      <h3 class="font-bold text-xl">Share Your Interview Experience</h3>
      <button
        (click)="close.emit()"
        type="button"
        class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"
        aria-label="Close"
      >
        âœ•
      </button>
    </div>

    <!-- Title & Company -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <label class="form-control w-full">
        <div class="label"><span class="label-text">Title</span></div>
        <input
          type="text"
          formControlName="title"
          class="input input-bordered w-full"
          placeholder="e.g. My Amazon SDE-1 Interview"
        />
      </label>
      <label class="form-control w-full">
        <div class="label"><span class="label-text">Company</span></div>
        <app-company-combobox
          [value]="experienceForm.get('companyName')?.value"
          (valueChange)="experienceForm.get('companyName')?.setValue($event)"
        >
        </app-company-combobox>
      </label>
    </div>

    <!-- Position, Experience Type, Interview Date -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <label class="form-control w-full">
        <div class="label"><span class="label-text">Position</span></div>
        <input
          type="text"
          formControlName="position"
          class="input input-bordered w-full"
          placeholder="e.g. SDE-1"
        />
      </label>
      <label class="form-control w-full">
        <div class="label"><span class="label-text">Experience Type</span></div>
        <select
          formControlName="experienceType"
          class="select select-bordered w-full"
        >
          <option value="TECHNICAL">Technical</option>
          <option value="HR">HR</option>
          <option value="MR">MR</option>
        </select>
      </label>
      <label class="form-control w-full">
        <div class="label"><span class="label-text">Interview Date</span></div>
        <input
          type="date"
          formControlName="interviewDate"
          class="input input-bordered w-full"
        />
      </label>
    </div>

    <!-- Summary -->
    <label class="form-control">
      <div class="label"><span class="label-text">Summary</span></div>
      <textarea
        formControlName="summary"
        class="textarea textarea-bordered w-full"
        rows="4"
        placeholder="Write a short summary of your experience..."
      ></textarea>
    </label>

    <!-- Questions Section -->
    <div class="space-y-4">
      <h3 class="text-lg font-semibold">Questions</h3>
      <div
        formArrayName="questions"
        class="max-h-60 overflow-y-auto no-scrollbar space-y-3"
      >
        <div
          *ngFor="let q of questions.controls; let i = index"
          [formGroupName]="i"
          class="grid grid-cols-[1fr_auto_auto] sm:grid-cols-[1fr_160px_32px] items-center gap-2"
        >
          <input
            type="text"
            formControlName="questionText"
            placeholder="e.g. What is OOP?"
            class="input input-bordered w-full"
          />
          <select
            title="questionType"
            formControlName="questionType"
            class="select select-bordered w-full"
          >
            <option value="TECHNICAL">Technical</option>
            <option value="HR">HR</option>
            <option value="MR">MR</option>
          </select>
          <button
            type="button"
            (click)="removeQuestion(i)"
            class="btn btn-ghost btn-square text-error"
            title="Remove question"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
              />
            </svg>
          </button>
        </div>
      </div>
      <button
        type="button"
        (click)="addQuestion()"
        class="btn btn-outline w-full sm:w-auto"
      >
        + Add Question
      </button>
    </div>

    <!-- Submit / Cancel Buttons -->
    <div class="flex justify-center gap-3 pt-4">
      <button
        type="button"
        (click)="close.emit()"
        class="btn btn-ghost px-6 py-2"
      >
        Cancel
      </button>
      <button
        type="submit"
        class="btn btn-primary px-6 py-2"
        [disabled]="!experienceForm.valid"
      >
        Submit Experience
      </button>
    </div>
  </form>
</div>
